generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model plans {
  id             Int       @id @default(autoincrement())
  code           String    @unique
  name           String
  tenants        tenants[]
}

model tenants {
  id               Int           @id @default(autoincrement())
  name             String
  plan_id          Int
  timezone         String        @default("Europe/Moscow")
  invoice_required Boolean       @default(false)
  plan             plans         @relation(fields: [plan_id], references: [id])
  users            users[]
  dict_trucks      dict_trucks[]
  dict_sites       dict_sites[]
  shifts           shifts[]
  invites          invites[]
}

model users {
  id            Int      @id @default(autoincrement())
  tenant_id     Int
  role          String
  full_name     String?
  tg_user_id    BigInt?  @unique
  email         String?  @unique
  password_hash String?
  current_state String   @default("idle")
  hourly_rate   Decimal  @default(0) @db.Decimal(12, 2)
  tenant        tenants  @relation(fields: [tenant_id], references: [id])
  shifts        shifts[]
}

model dict_trucks {
  id        Int      @id @default(autoincrement())
  tenant_id Int
  name      String
  plate     String?
  is_active Boolean  @default(true)
  is_busy   Boolean  @default(false)
  tenant    tenants  @relation(fields: [tenant_id], references: [id])
  shifts    shifts[]
}

model dict_sites {
  id                Int      @id @default(autoincrement())
  tenant_id         Int
  name              String
  odometer_required Boolean  @default(false)
  invoice_required  Boolean  @default(false)
  tenant            tenants  @relation(fields: [tenant_id], references: [id])
  shifts            shifts[]
}

model shifts {
  id                 Int          @id @default(autoincrement())
  tenant_id          Int
  user_id            Int
  truck_id           Int?
  site_id            Int?
  status             String
  start_time         DateTime?
  end_time           DateTime?
  hours_worked       Decimal      @default(0) @db.Decimal(12, 2)
  salary             Decimal      @default(0) @db.Decimal(12, 2)
  photo_start_url    String?
  photo_end_url      String?
  photo_invoice_url  String?
  comment            String?
  updated_at         DateTime     @updated_at
  tenant             tenants      @relation(fields: [tenant_id], references: [id])
  user               users        @relation(fields: [user_id], references: [id])
  truck              dict_trucks? @relation(fields: [truck_id], references: [id])
  site               dict_sites?  @relation(fields: [site_id], references: [id])
}

model invites {
  id         Int      @id @default(autoincrement())
  tenant_id  Int
  code       String   @unique
  expires_at DateTime
  status     String   @default("pending")
  tenant     tenants  @relation(fields: [tenant_id], references: [id])
}
